<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>我的音乐</title>
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" type="text/css" href="css/mymusic.css">
    <link rel="stylesheet" type="text/css" href="css/musicRadio.css">
    <link rel="shortcut icon" type="image/x-icon" href="images/logo1.png">
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="js/common.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript"
            src="http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"></script>
</head>
<body style="user-select: none">
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"
     style="overflow: auto;">
    <div class="modal-dialog" style="overflow: auto;">
        <div class="modal-content" style="overflow: auto;">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="false">X</button>
                <h4 class="modal-title" id="myModalLabel">账号密码登录</h4>
            </div>
            <div class="modal-body" style="position: relative;">
                <form id="test" class="form-horizontal" role="form" action="/user/loginPage" method="post"
                      style="padding-left: 50px;">
                    <div class="form-group">
                        <img src="images/logo2.png" style="display: block; padding: 20px 151px">
                        <div class="erweima"><img src="images/QCcode2.png" style="position: absolute;width: 130px;
						height: 130px;bottom: 136px;right: 31px;">
                            <p style="position: absolute;right: 64px;bottom: 106px;">联系我们</p>
                        </div>
                        <label class="col-sm-2 control-label">
                            <span class="glyphicon glyphicon-user">账号</span>
                        </label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="user_name" name="user_name"
                                   placeholder="手机号/QQ号/微信号" style="width: 250px">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">
                            <span class="glyphicon glyphicon-lock">密码</span>
                        </label>
                        <div class="col-sm-10">
                            <input type="password" class="form-control" id="user_password" name="user_password"
                                   placeholder="password" style="width: 250px">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-10">
                            <div class="checkbox">
                                <label>
                                    <input type="checkbox"> 记住密码
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="modal-footer">
                            <button class="btn btn-primary" data-dismiss="btn btn-default"
                                    style="background-color: #169af3;padding: 5px 30px">登 &nbsp&nbsp&nbsp&nbsp录
                            </button>
                            <a href="/register.html" style="float: left;padding-top: 12px;">没有账号？点此注册</a>
                        </div>
                    </div>
                </form>
            </div>

        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div>
<div style="width: 100%;height: 80px; background-color:#fff;position: relative;">
    <div style="position: absolute;bottom: -5px;height: 5px;width: 100%;background-color:#fff;z-index: -1;"></div>
    <div class="search1">
        <div class="logo1" style="width: 153px; padding: 20.6px 0; display: inline-block;"><img src="images/logo2.png"
                                                                                                alt=""><a href="#"></a>
        </div>
        <nav class="navmargin navbar navbar-default" role="navigation">
            <div class="shurukuang" style="padding: 20.6px 30px;">
                <form class="bs-example" role="form" action="#" method="get">
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="input-group">
                                <input type="text" id="songName" name="songName" class="form-control"
                                       placeholder="为音乐而生">
                                <span class="input-group-btn">
								 <button onclick="getList2($('#songName').serialize())" class="btn btn-default"
                                         type="button">
									搜索
								</button>
							</span>


                            </div><!-- /input-group -->
                        </div><!-- /.col-lg-6 -->
                        <div id="clock">
                            <p class="date">{{ date }}</p>
                            <p class="time">{{ time }}</p>
                        </div>
                    </div><!-- /.row -->
                </form>
            </div>
            <!-- 图标加上搜索框结束 -->
            <div id="col10" class="dengluzhuce">
                <a class="mymusic" href="/mymusic.html" target="_self" onclick="return isLogin();">我的音乐</a>
                <a class="mymusic" onclick="return isLogin();" href="/mymusic.html" target="_self">您是第<span
                        id="user_number" style="font-size:20px;color:red;text-align:center;padding:0;"> &nbsp</span>位用户</a>
                <span class="mymusic">|</span>
                <img id="touxiang" src="images/touxiang.png" width="40px" height="40px"
                     style="display: inline-block; width: 40px;height: 40px;border:0;border-radius: 40px;margin-bottom: 5px;">
                <a id="userName" style="cursor: pointer;" class="mymusic">
                    未登录</a>
                <a id="zhuXiao" onclick="zhuXiao();location.reload();" href="#">
                </a>
                <button id="display1" class="btn denglu" data-toggle="modal" data-target="#myModal">登 &nbsp&nbsp录
                </button> <!--触发模态框按钮-->
            </div>
        </nav>
    </div>
</div>
<nav class="daohanglan">
    <div class="big3">
        <ul>
            <li><a class="gudingbeij erjicaidan2" href="/index.html">首页</a></li>
            <li><a class=" erjicaidan2" href="/musicRadio.html">电台</a></li>
            <li><a class="erjicaidan2" href="/singer.html">歌手</a></li>
            <li class="dropdown">
                <a class="erjicaidan2" href="#" class="dropdown-toggle" data-toggle="dropdown">
                    更多 <b class="caret"></b>
                </a>
                <ul class="dropdown-menu">
                    <li><a class="erjicaidan" href="/musicRadio.html">电台</a></li>
                    <li><a class="erjicaidan" href="/songlist.html">歌单</a></li>
                    <li><a class="erjicaidan" href="/singer.html">歌手</a></li>
                </ul>
            </li>
        </ul>
        <ul>
            <li class="youfudong"><a href="/musicSearchTest.html" target="_self"><span
                    class="glyphicon glyphicon-search" style="font-size: 14px"> 搜索</span></a></li>
            <li class="youfudong"><a href="#" target="_blank"><span onclick="playMusic()"
                                                                    class="glyphicon glyphicon-star-empty"
                                                                    style="font-size: 14px"> 在线播放</span></a></li>
        </ul>
    </div>
    </div>
</nav>


<!--我的音乐-->
<div class="headerbg">
    <div class="geRenZiLiao">
        <div class="touxiang">
            <img src="images/gerentouxianag.jpeg" class="img-circle txborder">
        </div>
        <h3 class="mingzijuzhong"><span><img src="images/huiyuan.png" alt="会员" width="auto" height="30px"></span></h3>
        <ul class="gzfs">
            <li class="guanzhu">
                <strong class="gznumber">66</strong>
                <span class="gztit">关注</span>
            </li>
            <li class="guanzhu fsnumber">
                <strong class="gznumber">8888</strong>
                <span class="gztit">粉丝</span>
            </li>
        </ul>
        <div class="headernav">
            <a href="#songList" class="hnava" data-toggle="tab">我创建的歌单</a>
            <a href="#follow" class="hnava" data-toggle="tab">关注</a>
        </div>
    </div>
</div>


<div class="tab-pane fade in active" id="songList">
    <div class="contentN">
        <div class="fenleititle">
            <div class="fenlei_left">歌单</div>
            <div class="fenlei_right" id="myTitle">请选择歌单</div>
        </div>
        <div class="content_left" id="songListView">

        </div>
        <div class="content_right_new tab-content" id="songListContent">
        </div>
    </div>
</div>
<div class="tab-pane fade in" id="follow">
    <div class="contentN">

    </div>
</div>


<script src="js/jquery.min.js?v=2.1.4"></script>
<script src="js/bootstrap-paginator.min.js"></script>
<script src="js/jquery.validate.min.js"></script>
<script src="js/tools.js"></script>
<script src="js/jquery.cookie.js"></script>
<script type="text/javascript" src="js/vue.min.js"></script>
<script type="text/javascript">


    if ($.cookie("user_name") != undefined && $.cookie("user_name") != "1") {//如果用户名不等于1且不等于未定义，则继续执行
        $("#userName").text("账号：" + $.cookie("user_name"));//将未登录3个字替换为用户名
        $("#zhuXiao").text("注销");//将注销加在用户名后方
        $(".mingzijuzhong").text("用户: " + $.cookie("user_name"));//替换大头像下面的用户名
        document.getElementById("touxiang").src = "images/touxiang2.jpg";//替换原始头像
        $("#display1").attr("style", "display:none;");//隐藏登录按钮
    }

    $('#test').validate({
        submitHandler: function (form) {
            denglu($('#test').attr("action"), $('#test').serialize());//调用tools文件里的denglu方法，详情见tools
        }
    });

    getList2();

    function getList2() {
    if(isBlank($.cookie("user_id"))){
        return
    }
        $.ajax({
            url: "myMusic/getMyMusicList",      //后台获取整个数据库方法的地址
            type: "POST",
            data: {
                "user_id": $.cookie("user_id")
            },
            success: function (data) {
                if (data.statusCode == "200") {
                    if ($.cookie("user_id")) {
                        $("#user_number").html($.cookie("user_id"));
                    } else {
                        var x = 100;
                        var y = 200;
                        var result = Math.floor(Math.random() * (y + 1 - x) + x);
                        $("#user_number").html(result);
                    }

                    songs = data.data;
                    inittabContent(songs);

                }
            },
            error: function (data) {
                alert(JSON.stringify(data));
            }

        })
    }

    function inittabContent(songs) {
        songs = songs.list;
        var divSongListView = document.getElementById("songListView");
        var divSongListContent = document.getElementById("songListContent");

        var songListNameContent = "";
        var SongListContent = "";
        var songLists = [];
        var numMap = new Map();

        var contenAllRadio = "";
        var contentEnglishMinorRadio = "";
        var contentHatsuneMikuRadio = "";
        var contentCoffeeRadio = "";
        var contentAbsoluteMusicRadio = "";
        for (let i = 0; i < songs.length; i++) {
            var songListName = songs[i].song_list_name;
            var tempsongListNameContent = "";
            if (songLists.indexOf(songListName) == -1) {
                numMap.set(songListName, "");
                songLists[songLists.length] = songListName;
                tempsongListNameContent = getSongListRow(songLists.length, songListName);
            }
            numMap.set(songListName, numMap.get(songListName) + getSong(songs[i], i))
            songListNameContent += tempsongListNameContent
        }
        let i = 0
        for (let key of numMap) {
            console.log(key)
            key[1] = getSongColletc(key[1], i++)
            SongListContent += key[1]
        }

        var defaultInnerHtml = "      <span class=\"content_left_fenlei\"><a href=\"#songList0\" onclick=\"addSongList()\" >新增歌单</a></span>\n";
        divSongListView.innerHTML = divSongListView.innerText + defaultInnerHtml + songListNameContent;
      var defaultInnerHtml1=" <div class=\"tab-pane fade active in\" id=\"songList0\">\n" +
          "                <table style=\"width: 600px;margin: auto; overflow: auto;\">\n" +
          "                    <thead>\n" +
          "                    <tr style=\"border-bottom: 1px solid #919191;line-height: 35px;\">\n" +
          "                        <th style=\"text-align: center;font-size: 20px\">序号</th>\n" +
          "                        <th style=\"text-align: center;font-size: 20px\">歌名</th>\n" +
          "                        <th style=\"text-align: center;font-size: 20px\">歌手</th>\n" +
          "                    </tr>\n" +
          "                    </thead>\n" +
          "                    <tbody style=\"font-size: 16px\">\n" +
          "                    </tbody>\n" +
          "                </table>\n" +
          "            </div>"

        divSongListContent.innerHTML = divSongListContent.innerText +defaultInnerHtml1+ SongListContent;
    }




    function addSongList() {//删除已收藏歌曲的方法

        var name = prompt("请输入歌单名称", "")
        if (name != null && name != "") {

            $.ajax({
                async: false,//给ajax嵌套执行，所以需设定false
                url: "/myMusic/addSongList",//后台地址
                type: "post",//post请求方式
                data: {
                    "songListName": name,//传入歌曲id
                    "userId": $.cookie("user_id"),//传入用户id
                },
                success: function (data) {//webspond
                    if (data.statusCode == "200") {
                        window.location.reload();//刷新页面
                    } else {
                        alert("add error!" + data.statusMsg);
                    }

                },

            })
        }

    }

    //
    //
    //           数字时钟
    //
    //
    var clock = new Vue({
        el: '#clock',
        data: {
            time: '',
            date: ''
        }
    });
    var week = ['星期天', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'];
    var timerID = setInterval(updateTime, 1000);
    updateTime();

    function updateTime() {
        var cd = new Date();
        clock.time = zeroPadding(cd.getHours(), 2) + ':' + zeroPadding(cd.getMinutes(), 2) + ':' + zeroPadding(cd.getSeconds(), 2);
        clock.date = zeroPadding(cd.getFullYear(), 4) + '-' + zeroPadding(cd.getMonth() + 1, 2) + '-' + zeroPadding(cd.getDate(), 2) + ' ' + week[cd.getDay()];
    };

    function zeroPadding(num, digit) {
        var zero = '';
        for (var i = 0; i < digit; i++) {
            zero += '0';
        }
        return (zero + num).slice(-digit);
    }

    function getSongListRow(num, songListName) {
        var res = "  <span class=\"content_left_fenlei\"><a href=\"#songList#{num}\" onclick=\"changeTitle('#{songListName}')\" data-toggle=\"tab\">#{songListName}</a></span>\n"
        res = res.replace("#{num}", num)
        res = res.replace("#{songListName}", songListName)
        res = res.replace("#{songListName}", songListName)
        return res;

    }

    function getSong(song, num) {


        var str = ""
        if(isBlank(song.ml_songName)){
            return  str;
        }
        str += '<tr>'
            + '<td class="number111"  style="padding: 14px;border-bottom: 1px solid #eee; width: 100px;text-align: center;">' + num + '</td>'
            + '<td  style="padding: 14px;border-bottom: 1px solid #eee;width: 600px;text-align: center;"><a class=sName' + num + ' onclick="playMusic(\''+song.ml_songName+'\')" href="#">' + song.ml_songName + '</a>' +
            '<span class="glyphicon glyphicon-trash" onclick="delMusic(\''+song.song_list_id+'\',\''+song.ml_id+'\')" style="color: #2c323b;float: right;"></span></td>'
            + '<td style="padding: 14px;border-bottom: 1px solid #eee;width: 300px;text-align: center;"><a href="#" onclick="searchBySinger(\''+song.ml_singer+'\')">' + song.ml_singer + '</a></td>'
            + '</tr>';//将动态生成的表格添加到table标签中

        return str;

    }


    function getSongColletc(songContent, num) {
        var contenDiv = "    <div class=\"tab-pane fade \" id=\"songList#{num}\">\n" +
            "  <table style=\"width: 600px;margin: auto; overflow: auto;\">\n" +
            "        <thead>\n" +
            "        <tr style=\"border-bottom: 1px solid #919191;line-height: 35px;\">\n" +
            "        <th style=\"text-align: center;font-size: 20px\">序号</th>\n" +
            "        <th style=\"text-align: center;font-size: 20px\">歌名</th>\n" +
            "        <th style=\"text-align: center;font-size: 20px\">歌手</th>\n" +
            "\n" +
            "        </tr>\n" +
            "        </thead>\n" +
            "        <tbody style=\"font-size: 16px\">" +
            "#{songContent}" +
            " </tbody>\n" +
            "        </table>" +
            "            </div>"
        contenDiv = contenDiv.replace("#{num}", num + 1);
        contenDiv = contenDiv.replace("#{songContent}", songContent);

        return contenDiv;

    }

</script>
</body>
</html>